# 用户和文件

## 用户

root 账户是 Linux 系统的超级管理员账户，拥有操作系统的所有权限。

#### who 命令

```shell
# root
who am i
> username pts/0        2020-04-21 14:41 (:1.0)

# root
who mom likes
> username pts/0        2020-04-21 14:41 (:1.0)

# pre user
whoami
> username

# root
who -m
> username pts/0        2020-04-21 14:41 (:1.0)
```

`pts/{num}`中的`pts`表示伪终端，`{num}`表示用户打开的伪终端序号。

相对来说，`dev/tty`是真终端，`pts`是在某个真终端下的伪终端，可以存在多个。


| param | description                |
| ----- | -------------------------- |
| `-a`  | 打印能打印的全部           |
| `-d`  | 打印死掉的进程             |
| `-m`  | 同`am i`，`mom likes`      |
| `-q`  | 打印当前登录用户数及用户名 |
| `-u`  | 打印当前登录用户登录信息   |
| `-r`  | 打印运行等级               |

#### sudo、su、su - 命令

一般不会使用 root 账户直接登录系统，因为 root 拥有所有权限，很可能会在不经意间做出难以挽回的操作。

当普通账户需要使用权限时，可以在命令前加一个`sudo`来提升权限。

#### 创建用户：

```shell
sudo adduser {username}
```

#### 切换用户：

```shell
su -l {username}
su - {username}
```

#### 更改密码

更改当前用户密码：

```shell
passwd
```

更改其他用户密码（需要 root 权限）：

```shell
sudo passwd {username}
```





## 用户组

在 Linux 中，每个用户从属于一个用户组。

用户组可以拥有一些资源，比如读写、执行某个文件的权限。

#### groups 命令查看用户组：

```shell
groups {username}
> {username}:{groupList}
```

#### 查看 `/etc/group ` 文件：

```shell
# cat 用于读取和输出指定文件，| sort 表示在输出前进行一次字典排序
cat /etc/group | sort
```

或

```shell
# grep -E 用于过滤内容
cat /etc/group | grep -E "string"
```

group 文件的格式为：`group:pwd:GID:userList`

当用户的 UID 与用户组的 GID 一致时，在 `/etc/group`文件中的`group:pwd:GID:`后不会显示该用户。

> GID：group ID
> UID：user ID

#### 将用户添加到用户组：

```shell
# -G 意为强制将 group 作为新主组
sudo usermod -G {groupName} {username}
```

`-G`代表要对用户进行添加用户组操作。该命令有很多功能，可以使用`--help`查看。

#### 删除用户：

```SHELL
sudo deluser {username} --remove-home
```

`--remove-home`代表删除用户的同时删除用户主目录。

若不加这个参数则不会删除用户主目录，当下一个同名用户被创建时，其主目录文件不会发生改变。

#### 删除用户组：

```shell
sudo delgroup {groupName}
# 或者
sudo groupdel {groupName}
```

#### 相似命令：

|          |          |
| -------- | -------- |
| adduser  | useradd  |
| deluser  | userdel  |
| delgroup | groupdel |
| ...      | ...      |

动词在后的，如 `useradd`，像是一种比较精确的命令， `useradd `就是添加用户，不会做任何其他操作，包括不会设置密码，不会创建工作目录s等...

而动词在前的，如 `adduser`，则会提示你并做一系列对该用户的初始化的操作。





## 文件操作

在 Linux 中，一切皆文件。

### Linux 文件系统

与 Windows 不同，Linux 的文件系统是基于目录的。

目录是 Linux 系统的骨架，任何可以访问的储存介质（磁盘、U 盘、网络文件）都是挂载在目录下的。



### FHS 标准

FHS（Filesystem Hierarchy Standard）—— **文件系统层次化标准**。

> Filesystem Hierarchy Standard（文件系统层次化标准）的缩写，多数Linux版本采用这种文件组织形式，类似于Windows操作系统中c盘的文件目录，FHS采用树形结构组织文件。FHS定义了系统中每个区域的用途、所需要的最小构成的文件和目录，同时还给出了例外处理与矛盾处理。
>
> —— 百度百科

![Linux 文件系统](https://img-blog.csdnimg.cn/20200729225807515.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2MTgxODM3,size_16,color_FFFFFF,t_70)

![四种交互形态](https://img-blog.csdnimg.cn/20200729230936465.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2MTgxODM3,size_16,color_FFFFFF,t_70)

常见目录：

| 符号 | 解释           |
| ---- | -------------- |
| `~`  | 用户主目录     |
| `-`  | 上一次所在目录 |
| `.`  | 当前目录       |
| `..` | 上级目录       |



### 文件基本操作

#### 进入一个目录：

```shell
cd {pathName}
```

#### 查看当前目录：

```shell
pwd
```

#### 列出文件：

```shell
ls {pathName}
```

快捷键：


| description                                | key           |
| ------------------------------------------ | ------------- |
| 结束当前任务                               | Ctrl+c        |
| 键盘输入结束或退出终端                     | Ctrl+d        |
| 暂停当前程序，暂停后按下任意键恢复运行     | Ctrl+s        |
| 将当前程序放到后台运行，恢复到前台为命令fg | Ctrl+z        |
| 将光标移至输入行头，相当于Home键           | Ctrl+a        |
| 将光标移至输入行末，相当于End键            | Ctrl+e        |
| 删除从光标所在位置到行末                   | Ctrl+k        |
| 向前删除一个单词                           | Alt+Backspace |
| 将终端显示向上滚动                         | Shift+PgUp    |
| 将终端显示向下滚动                         | Shift+PgDn    |
| 显示历史输入                               | Up            |

通配符：


| key                | description                                        |
| ------------------ | -------------------------------------------------- |
| *                  | 匹配0 个或多个字符                                 |
| ?                  | 匹配任意一个字符                                   |
| [char1, char2...]  | 在列表中匹配任意单一字符（不能用于创建文件）       |
| [^char1, char2...] | 匹配任意非该列表包含的单一字符（不能用于创建文件） |
| [char1-char2]      | 匹配任意单一字符（不能用于创建文件）               |
| {str1, str2...}    | 在集合中匹配一个字符串                             |
| {str1...strn}      | 匹配字符串                                         |

#### `ls`命令详解：

显示当前目录的所有文件：

```shell
ls -a
# 显示完整属性
ls -al
```

显示带单位的文件大小：

```shell
ls -asSh
```

查看目录信息：

```shell
ls -dl {dir}
```

参数：


| param | description                           |
| :---: | ------------------------------------- |
|  -a   | all，显示当前目录所有文件             |
|  -d   | 后跟目录名，查看该目录的属性          |
|  -h   | human readable 以人类看得懂的方式呈现 |
|  -s   | 显示文件大小                          |
|  -S   | 以文件大小排序                        |
|  -l   | 显示更多的格式信息                    |

#### 新建文件：

```shell
touch {filename}
```

`touch`命令在不加任何参数的情况下，仅指定一个文件名，则创建一个空白文件，且不会覆盖已有文件，而是更新其时间戳。`touch`还有很多用法，以后会详细讲解。

#### 新建目录：

```shell
mkdir {dir}
```

在 Linux 中，一切皆文件，即目录也是文件。也就是说，在某个目录下，不能同时存在同名的目录和文件。

这与 Windows 的文件系统完全不同。

参数：

|      |                        |
| ---- | ---------------------- |
| `-m` | 指定文件权限           |
| `-p` | 若可以，则创建父级目录 |
| `-v` | 输出每个动作           |

#### 复制：

```shell
cp {src} {target}
```

例如`cp ./file.txt ./dir`即将`file.txt`复制到`./dir`目录下。

对于目录，需要加一个`-r/R`参数，表示递归复制。

`-v`可以输出每个步骤。

#### 删除：

```shell
rm {dir/filename}
```

对于目录，同样需要加一个`-r/R`参数代表递归删除。

参数`-f`可以忽略提示，强制删除文件。

`-v`可以输出每个步骤。

#### 移动：

```shell
mv {src} {target}
```

#### 重命名：

```shell
mv {old} {new}
```

还可以使用`rename`，之后再介绍。

#### 查看文件：

##### `cat`按行正序打印，`tac`按行倒序打印：

```shell
cat {filename}
```

参数：

|      |                                                              |
| ---- | ------------------------------------------------------------ |
| `-b` | `-b a`（默认）显示空行号，`-b t`不显示空行号                 |
| `-n` | `-n ln`左端显示行号，`-n rn`右端显示行号（不加 0），`-n rz`右端显示行号（加 0） |
| `-w` | 设置行号宽度，默认 6                                         |

##### `more`和`less`命令阅读文件：

```shell
more {filename}
```

`more`命令阅读文件时只能向下滚动内容，`enter`滚动一行，`space`滚动一屏。

```shell
less {filename}
```

`less`强大一些，与`man`命令阅读手册时的阅读器一样。

##### `head`和`tail`查看文件头尾几行文本：

```shell
head {filename}
```

```shell
tail {filename}
```

默认查看十行文本，可以使用`-n`参数指定行数。

对于`tail`，可以使用`-f`命令，动态读取文件内容，可以让我们动态查看日志。

##### `file`查看文件类型

```shell
file {filename}
```



### 文件查找

注意，使用通配符时需要转义，例如`*.txt`应写成`\*.txt`。

#### `whereis`命令：

`whiereis`仅搜索二进制文件、man 帮助文件和源代码文件。

```shell
whereis {filename}
```

可选`-b` `-m` `-s`三个参数指定仅搜索某种文件。

#### `locate`命令：

`lacate`需要安装，他会搜索所有的文件。

```shell
locate {filename} # 
```

`locate`会从`/var/lib/mlocate/mlocate.db`数据库中检索数据，但这个数据库并不是即时更新的，而是系统定时更新的。

我们可以使用`updatedb`来手动更新数据库：

```shell
updatedb
```

#### `which`命令：

`which`用来确定某命令来自哪个文件的，他仅从`PATH`中搜索命令并返回第一个结果。

```shell
which {command}
```

#### `find`命令：

`find`是最强大的搜素命令，这里简单介绍。

搜索某目录下的某文件。

```shell
sudo find {dir} -name {filename}
```



#### 

## 文件权限

在 Linux 中，不同用户可能拥有不同的文件访问权限，这些权限可以手动设置。

#### 文件信息

`ls -l`命令会输出目录下的文件信息，

取一条来看：

> -rw-r--r--   1 shiyanlou shiyanlou   1543 9月 19  2019 package.json

从左到右依次为：
文件类型和权限	链接数	所有者	所属用户组	文件大小	最后修改时间	文件名

![文件信息](https://img-blog.csdnimg.cn/20200729172037217.png)

#### 文件类型和权限

形如`drwxr-xr-x`的文件信息，包含 “文件类型” 和 “权限信息”

应该拆分为`d	rwx	r-x	r-x`，从左到右依次为：

文件类型、拥有者权限、所属用户组权限、其他用户权限

权限信息包含：拥有者权限、所属用户组权限 和 其他用户权限

![img](https://doc.shiyanlou.com/linux_base/3-10.png)


| 文件类型 | description |
| :------: | ----------- |
|    d     | 目录        |
|    l     | 软连接      |
|    b     | 块设备      |
|    c     | 字符设备    |
|    s     | socket      |
|    p     | 管道        |
|    -     | 普通文件   |

权限信息三个为一组：


| 权限信息 | description  |
| :------: | ------------ |
|    r     | read 读权限  |
|    w     | write 写权限 |
|    x     | 执行权限     |

注意！！同时拥有一个目录的读权限（r）和执行权限（x）时才可以查看内部文件。

#### 变更文件所有者

```shell
sudo chown {username} {filename}
```

#### 修改文件权限

##### 法1. 数字表示

将文件权限信息 **rwx** 与 **三个二进制数** 对应，如 111 代表 rwx， 010 代表 -w-

同时十进制数 7 也可以表示 rwx，同理 -w- 可用十进制数 2 表示

我们知道，权限信息由 拥有者权限、所属用户组权限 和 其他用户权限组成

那么三种权限则可以由 **九个二进制数** 或 **一个小于 1024 的十进制数** 表示 

例如 600 可表示 -rw-------，即仅拥有者（和超级管理员）可读写

```shell
chmod {permission} {filename}
# e.g. chomd 600 privateFile.txt
```

##### 法2. u、g、o

首先表示出需要更改的权限类型：

u（user）拥有者权限

g（group）所属用户组权限

o（others）其他用户权限

后跟	+（添加）	-（删除）	来表示需要如何更改权限

后跟 rwx 来表示需要修改当前权限类型的何种权限

```shell
chmod {operation} {filename}
# eq. chmod u+rwx privateFile.txt
```





## 文件打包

### zip 压缩打包

#### `zip`打包：

```shell
zip -r -q -9 -o {pack} {dir}
```

`-r`表示递归打包子目录，`-q`是静默打包，不输出信息，`-9`是压缩质量，最高 9 最低 1，`-o`后紧跟输出的文件。

另外还可以加一个参数`-e`进行加密打包。

对于跨平台的换行问题，可以通过`-l`参数在打包的同时进行转换，将`LF`转换为`CRLF`。	

#### `unzip`解包：

```shell
unzip -q {pack}
```

可以使用`-d {dir}`指定解压目录：`unzip -q {pack} -d {dir}`。

`-O`可以指定编码，例如`-O GBK`。

`unzip`可以用来查看压缩包信息，通过`-l`参数：`unzip -l {pack}`。



### tar 打包

#### `tar`打包：

```shell
tar -cf {pack} {dir}
```

`-c`表示创建一个`tar`包文件，`-f {pack}`用于指定创建的文件名。

可选参数`-p`，保留文件属性（权限等）。

可选参数`-h`，追踪链接并归档。

可选参数`-P`保留绝对路径符，即路径前的`/`。若保留，则解压时会按照绝对路径进行解压。

同样，解压时也可通过`-P`参数指定是否通过绝对路径解压。不过，对于根本就不是绝对路径的文件，不会按照绝对路径解压。

默认尽可能地按照相对路径解压，防止意外覆盖文件。

#### `tar`解包：

```shell
tar -xf {pack} -C {dir}
```

`-x`表示解包，`-C {dir}`指定解包目录。

可选参数`-P`保留绝对路径符，对于不是绝对路径的文件，不会按照绝对路径解压。

#### `tar`使用压缩工具：

压缩时只需要加上对应参数即可，例如`gzip`对应`-z`：

```shell
tar -zcf {pack} {dir}
```

解包时统样：

```shell
tar -zxf {pack}
```

| 压缩文件格式 | 参数 |
| ------------ | ---- |
| `*.tar.gz`   | `-z` |
| `*.tar.xz`   | `-J` |
| `*tar.bz2`   | `-j` |





## 磁盘

#### `df`查看磁盘挂载情况：

```shell
df
```

#### `du`查看目录大小：

```shell
du -hd 0 {dir}
```

`du`用来浏览目录列表，并列出大小。

`-h`以易读的方式显示，`-d {num}`表示查看深度，从 0 开始。

可选`-s`仅显示总大小。

#### `dd`读写文件：

```shell
dd {options}
```

与其他命令不同，`dd`的参数通过`=`指定。

几个常用参数`if`(input file)、`of`(output file)、`bs`(block size)、`count`(bs 的数量)、`conv`(convert)。

`if`表示输入文件，可以指定一个文件，或指定输入设备`/dev/stdin`。

`of`表示输出文件，可以指定一个文件，或指定输出设备`/dev/stdout`。

`bs`和`count`指定输入大小，`bs`指定块大小，`count`指定有多少块。

`conv`可以指定`dd`如何处理我们的输入，例如`conv=ucase`会将输入的英文字母全部变成大写。


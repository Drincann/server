# PHP 基础

## PHP 代码结构

### PHP 标签

嵌入在 HTML 中：

```php
// html
<?php
    
// ...
    
?>
// html
```

作为一个单文件时允许标签不闭合：

```php
<?php
// ...
    
```

另外还允许简写（需要在`php.ini`中添加`short_open_tag = On`) :

```php
<?
// ...
?>
```

此外还允许使用`script`标签：

```php+HTML
<script language="php">
    // ...
</script>
```



### PHP 注释

单行注释：

```php
# 注释
// 注释
```

多行注释：

```php
/*
注释
注释
*/
```



### PHP 代码

PHP 代码以分号`;`结尾。

```php
<?php
echo "Hello world!";
?>
```

如果末尾存在`?>`，可以省略最后一行的分号`;`，但不建议这么做：

```php
<?php
echo "We wil not use“, ”‘Hello,World’";
echo "Hello world!"
?>
```





## PHP 变量和数据

### PHP 变量

#### 变量

PHP 是动态类型语言。

PHP 中想要引用变量必须以`$`符号开头：

```php
<?php
$str = "今天学妹去自习没找我！";
?>
```

`var_dump`可以输出某个变量的详细信息：

```php
<?php
$str = '明天怎么把她约出来呢？';// string 字面量允许使用单引号
var_dump($str);
?>
```

>string(33) "明天怎么把她约出来呢？"

`unset`可以将某个变量释放：

```php
<?php
$str = 'QAQ';
unset($str);
?>
```

#### 预定义变量：

| 变量名    | 描述                             |
| --------- | -------------------------------- |
| $_GET     | 用户通过 get 方式提交的数据      |
| $_POST    | 用户通过 post 方式提交的数据     |
| $_REQUEST | 用户通过 get/post 方式提交的数据 |
| $_SERVER  | 用户和服务器的基本信息数据       |
| $_FILES   | 用户提交的文件数据               |
| $_SESSION | session 数据                     |
| $_COOKIE  | cookie 数据                      |
| $GLOBALS  | 所有全局变量，注意不以下划线开头 |
| $_ENV     | 环境数据                         |

#### 变量的引用

PHP 存在变量的引用，通过`&`指示：

```php
<?php
$var = '';
$ref = &$var; // 引用
?>
```

PHP 的参数传递思想与 Java 相同，永远是**值传递**。这就意味着，我们不可能改变外部引用的指向。



### PHP 常量

#### 定义常量

使用`define`函数：

```php
<?php
define('VAL', 2);
?>
```

使用`const`关键字：

```php
<?php
const VAL = 2;
?>
```

#### 访问常量

引用常量不需要使用前导`$`符号：

```php
<?php
echo VAL;
?>
```

注意到`define`函数的特殊性，我们可以定义一些明显不合法的变量名，例如`1_INVALID`：

```php
<?php
define('1_INVALID', 2);
?>
```

这时直接访问该常量显然是语法错误，但是我们可以使用`constant`函数，它接收一个字符串参数，代表欲访问的常量名：

```php
<?php;
echo constant('1_INVALID');
?>
```

#### 魔术常量

魔术常量是 PHP 的预定义常量，随环境动态变化。

| 常量名            | 描述                         |
| ----------------- | ---------------------------- |
| \_\_DIR\_\_       | 当前文件绝对路径             |
| \_\_FILE\_\_      | 当前文件绝对路径，包含文件名 |
| \_\_FUNCTION\_\_  | 当前函数名                   |
| \_\_CLASS\_\_     | 当前类名                     |
| \_\_NAMESPACE\_\_ | 当前命名空间                 |
| \_\_METHOD_\_     | 当前方法名                   |
| \_\_LINE\_\_      | 当前代码行数                 |



### PHP 数据类型

#### PHP 数据类型

基本数据类型：`int`,`float`,`bool`,`string`

符合数据类型：`array`,`object`

特殊类型：`resource`(外部资源的引用),`null`

#### 布尔类型

在 PHP 中，`bool`赋值对大小写不敏感。

例如，下面的代码没有语法错误：

```php
<?php;
$boolean = trUe;
$boolean = faLsE;
?>
```

#### 进制

PHP 允许通过数值字面量前缀指定进制：

```php
<?php
$hex = 0xabc; # 十六进制
$oct = 0456;  //
$bin = 0b11101; //
?>
```

可以通过 C 风格的`printf`函数对变量进行格式化输出：

```php
<?php 
$hex = 0xabc;
printf('%0x', $hex);
?>
```

> abc

还可以通过`dechex`函数将十进制数转换为形式上的十六进制：

```php
echo dechex(123);
```

> 7b

此外还有全套类似风格的二进制转十进制`bindec`，十六进制转八进制`hexoct`等。

#### 字符串

在 PHP 中，允许字符串字面量用单引号`'`和双引号`"`表示，且存在区别。

单引号基本不转义字符，仅转义必要的字符，例如`\n`不会被转义，而显然必要的`'`会被转义。

双引号则可以转义更多的字符，例如`\n`,`\t`,`\r`,`\$`等。

额外地，双引号中允许使用`$val`引用变量，使用方法类似`js`中的模板字符串。

例如：

```php
<?php
$str1 = 'hello';
$str2 = '$str1 world';
echo $str2;
?>
```

> hello world

为了保证被引用变量名的正确性和可读性，PHP 允许使用`${val}`或`{$val}`来分割变量和其他子串。

同时，直接用空格将变量和其他子串隔开也是可以的。

此外，还有`heredoc`和`nowdoc`方式表示的字符串字面量，用来表示多行文本：

```php
<?php
$heredoc = <<<EOT
<html>
	<head>
		<title> </title>
	</head>
	
	<body>
	
	</body>
</html>
EOT;

$nowdoc = <<<'EOT'
<html>
	<head>
		<title> </title>
	</head>
	
	<body>
	
	</body>
</html>
EOT;
?>
```

上面代码展示了`heredoc`和`nowdoc`字符串字面量，前者的转义字符解析方式与双引号相同，后者与单引号相同。

即`heredoc`相当于双引号多行字符串字面量，`nowdoc`相当于单引号多行字符串字面量。

其中的`EOT`表示"结束标识符"/"定界符"，可以自定义，例如：

```php
<?php;
$str = <<<ABC
...
ABC;
?>
```

```php
<?php;
$str = <<<'_123'
...
_123;
?>
```

！！注意

- 在定界符内部，注释也被认为是文本的一部分
- 定界符后不允许出现任何内容
- 结束定界符不允许出现缩进

#### 类型判定

判定一个变量是否是某种类型。

例如通过`is_numeric`可以判断是否是数值型，`is_scalar`可以判断是否是基础类型。

此外就是各种准确类型，`is_int`，`is_bool`等...

#### 类型转换

PHP 可以使用 C 风格的类型转换：

```php
<?php
$toBeConverted = 10;
var_dump((bool)$toBeConverted);
?>
```

> bool(true)

还可以使用`settype`，这将改变该变量的类型：

```php
<?php
$int2bool = 0;
settype($int2bool, 'bool');
var_dump($int2bool);
?>
```

> bool(false)

### PHP 数组

PHP 的数组是 map 结构，相当于 js 原生支持的 JSON 格式一样，通过 key - value 储存数据。

#### 创建

创建一个数组：

```php
$map = array(/* ele ...*/);
```

或者通过字面量：

```php
$map = [/* ele... */];
```

初始化时可以使用`=>`指定`key`：

```php
$people = [
    'name' => '学妹',
    'chara' => '开朗活泼、上进又可爱',
    'age' => 17, 
    // 注意，与 js 相同，允许在末尾添加一个用于扩展的逗号
];
```

```php
$people = array(
    /* key */ => /* value */,
    /* key */ => /* value */,
    /* key */ => /* value */,
);
```



#### 添加/修改

`key`允许是任何数据类型：

```php
$map[/* key */] = /* val */;
```

向 map 尾部插入元素，`key`自动编号：

```php
$map[] = /* val */;
```

#### 删除

通过`unset`删除元素或整个数组：

```php
unset($map[/* key */]);
unset($map);
```